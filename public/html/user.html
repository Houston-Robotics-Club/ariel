<!DOCTYPE html>
<html>
  <head>
    <link href="/css/ariel.css" media="all" rel="stylesheet" />
    <script src="/js/simpleWebRTC.js"></script>
    <script src="/js/keypress-2.1.3.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body id="user">
      <div class="controls">
        <div id="videoContainer">
          <video id="localVideo"></video>
        </div>
        <button id="toggleLED">Toggle LED</button>
        <button id="forward">Forward</button>
        <button id="left">Left</button>
        <button id="right">Right</button>
        <button id="reverse">Reverse</button>
        <button id="stop">Stop</button>
      </div>
      <div id="remotesVideos"></div>
      <script>
        var listener = new window.keypress.Listener();
        var socket = io();
        socket.emit('newUser');

        var webrtc = new SimpleWebRTC({
          localVideoEl: 'localVideo',
          remoteVideosEl: 'remotesVideos',
          autoRequestMedia: true
        });

        webrtc.on('readyToCall', function () {
          webrtc.joinRoom('Houston Robotics Club: Ariel');
        });

        var commands = [
          {"com": "toggleLED", "key": "l" },
          {"com": "forward", "key": "up" },
          {"com": "left", "key": "left" },
          {"com": "right", "key": "right" },
          {"com": "reverse", "key": "down" },
          {"com": "stop", "key": "space" }
        ];

        commands.forEach( function(command) {
          command.el = document.getElementById(command.com);
          command.el.addEventListener("click", function() {
            socket.emit(command.com);
          });
          listener.register_combo({
            "keys"              : command.key,
            "on_keydown"        : function() { socket.emit(command.com) },
            "on_release"        : function() { socket.emit("stop") },
            "prevent_default"   : true,
            "prevent_repeat"    : true
          });
        });

      </script>
  </body>
</html>
